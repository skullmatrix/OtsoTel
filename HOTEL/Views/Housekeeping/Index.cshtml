@{
    ViewData["Title"] = "Housekeeping Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var currentUser = ViewBag.CurrentUser;

    var roomsToCleanCount = ViewBag.RoomsToCleanCount;
    var priorityRoomsCount = ViewBag.PriorityRoomsCount;

    var maintenanceRequestsCount = ViewBag.MaintenanceRequestsCount;
    var urgentMaintenanceCount = ViewBag.UrgentMaintenanceCount;

    var completedTodayCount = ViewBag.CompletedTodayCount;
    var aheadOfScheduleCount = ViewBag.AheadOfScheduleCount;
}

<div class="container-fluid py-4">
    <h1 class="mb-4">Welcome, @currentUser</h1>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-2 text-center">
                    <div class="rounded-circle bg-success bg-opacity-10 p-3 mx-auto" style="width: 80px; height: 80px;">
                        <i class="fas fa-user text-success" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <div class="col-md-10">
                    <h2 class="h3 mb-1">@currentUser</h2>
                    <span class="badge bg-success rounded-pill">Housekeeping</span>

                    <div class="row mt-4">
                        <div class="col-md-2 col-4">
                            <a href="@Url.Action("Index", "Housekeeping")" class="text-decoration-none text-center d-block">
                                <div class="bg-light rounded p-3 mb-2">
                                    <i class="fas fa-home text-primary"></i>
                                </div>
                                <span class="small">Home</span>
                            </a>
                        </div>
                        <div class="col-md-2 col-4">
                            <a href="@Url.Action("CleaningSchedule", "Housekeeping")" class="text-decoration-none text-center d-block">
                                <div class="bg-light rounded p-3 mb-2">
                                    <i class="fas fa-calendar-check text-primary"></i>
                                </div>
                                <span class="small">Cleaning Schedule</span>
                            </a>
                        </div>
                        <div class="col-md-2 col-4">
                            <a href="@Url.Action("Maintenance", "Housekeeping")" class="text-decoration-none text-center d-block">
                                <div class="bg-light rounded p-3 mb-2">
                                    <i class="fas fa-tools text-primary"></i>
                                </div>
                                <span class="small">Maintenance</span>
                            </a>
                        </div>
                        <div class="col-md-2 col-4">
                            <a href="#" class="text-decoration-none text-center d-block">
                                <div class="bg-light rounded p-3 mb-2">
                                    <i class="fas fa-bell text-primary"></i>
                                </div>
                                <span class="small">Notifications</span>
                            </a>
                        </div>
                        <div class="col-md-2 col-4">
                            <a href="#" class="text-decoration-none text-center d-block">
                                <div class="bg-light rounded p-3 mb-2">
                                    <i class="fas fa-cog text-primary"></i>
                                </div>
                                <span class="small">Settings</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mb-4">
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button" role="tab" aria-controls="tasks" aria-selected="false">Tasks</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab" aria-controls="reports" aria-selected="false">Reports</button>
            </li>
        </ul>
    </div>

    <div class="tab-content" id="dashboardTabsContent">
        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <h3 class="h5 mb-1">Rooms To Clean</h3>
                            <p class="text-muted small mb-3">Requiring attention today</p>

                            <h2 class="display-4 fw-bold text-success mb-1">@roomsToCleanCount</h2>
                            <p class="text-muted mb-0">@priorityRoomsCount priority rooms</p>

                            <div class="mt-3">
                                <a href="@Url.Action("CleaningSchedule", "Housekeeping")" class="btn btn-sm btn-outline-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <h3 class="h5 mb-1">Maintenance Required</h3>
                            <p class="text-muted small mb-3">Issues reported</p>

                            <h2 class="display-4 fw-bold text-danger mb-1">@maintenanceRequestsCount</h2>
                            <p class="text-muted mb-0">@urgentMaintenanceCount urgent maintenance</p>

                            <div class="mt-3">
                                <a href="@Url.Action("Maintenance", "Housekeeping")" class="btn btn-sm btn-outline-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <h3 class="h5 mb-1">Completed Today</h3>
                            <p class="text-muted small mb-3">Rooms cleaned today</p>

                            <h2 class="display-4 fw-bold text-warning mb-1">@completedTodayCount</h2>
                            <p class="text-muted mb-0">@aheadOfScheduleCount ahead of schedule</p>

                            <div class="mt-3">
                                <a href="@Url.Action("CleaningSchedule", "Housekeeping")" class="btn btn-sm btn-outline-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Today's Cleaning Schedule</h5>
                            <a href="@Url.Action("CleaningSchedule", "Housekeeping")" class="btn btn-sm btn-outline-primary">View All</a>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Room</th>
                                            <th>Type</th>
                                            <th>Priority</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var task in ViewBag.RoomsToClean)
                                        {
                                            <tr>
                                                <td>@task.Room.RoomNumber</td>
                                                <td>@task.Room.Type</td>
                                                <td>
                                                    @if (task.Priority == "Urgent")
                                                    {
                                                        <span class="badge bg-danger">Urgent</span>
                                                    }
                                                    else if (task.Priority == "High")
                                                    {
                                                        <span class="badge bg-warning text-dark">High</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-primary">Normal</span>
                                                    }
                                                </td>
                                                <td>
                                                    @if (task.Status == "Pending")
                                                    {
                                                        <span class="badge bg-secondary">Pending</span>
                                                    }
                                                    else if (task.Status == "In Progress")
                                                    {
                                                        <span class="badge bg-info">In Progress</span>
                                                    }
                                                    else if (task.Status == "Completed")
                                                    {
                                                        <span class="badge bg-success">Completed</span>
                                                    }
                                                </td>
                                                <td>
                                                    <div class="btn-group">
                                                        @if (task.Status == "Pending")
                                                        {
                                                            <form action="@Url.Action("UpdateTaskStatus", "Housekeeping")" method="post">
                                                                @Html.AntiForgeryToken()
                                                                <input type="hidden" name="id" value="@task.Id" />
                                                                <input type="hidden" name="status" value="In Progress" />
                                                                <button type="submit" class="btn btn-sm btn-primary">Start</button>
                                                            </form>
                                                        }
                                                        else if (task.Status == "In Progress")
                                                        {
                                                            <form action="@Url.Action("UpdateTaskStatus", "Housekeeping")" method="post">
                                                                @Html.AntiForgeryToken()
                                                                <input type="hidden" name="id" value="@task.Id" />
                                                                <input type="hidden" name="status" value="Completed" />
                                                                <button type="submit" class="btn btn-sm btn-success">Complete</button>
                                                            </form>
                                                        }
                                                        else
                                                        {
                                                            <button class="btn btn-sm btn-secondary" disabled>Completed</button>
                                                        }
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Cleaning Progress</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="cleaningProgressChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tasks" role="tabpanel" aria-labelledby="tasks-tab">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Your Tasks</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Clean rooms 201-205</h6>
                                <p class="small text-muted mb-0">Priority for check-ins today</p>
                            </div>
                            <span class="badge bg-warning text-dark">High Priority</span>
                        </div>
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Restock cleaning supplies</h6>
                                <p class="small text-muted mb-0">Running low on room fresheners</p>
                            </div>
                            <span class="badge bg-primary">Normal</span>
                        </div>
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Report on bathroom maintenance in room 304</h6>
                                <p class="small text-muted mb-0">Check shower drain</p>
                            </div>
                            <span class="badge bg-info">Low Priority</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Quick Reports</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-chart-line text-primary mb-3" style="font-size: 2rem;"></i>
                                    <h5>Cleaning Efficiency</h5>
                                    <p class="text-muted small">View cleaning times and efficiency metrics</p>
                                    <a href="#" class="btn btn-sm btn-outline-primary">Generate Report</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-clipboard-list text-success mb-3" style="font-size: 2rem;"></i>
                                    <h5>Inventory Status</h5>
                                    <p class="text-muted small">Check cleaning supplies inventory</p>
                                    <a href="#" class="btn btn-sm btn-outline-primary">Generate Report</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 2rem;"></i>
                                    <h5>Maintenance Issues</h5>
                                    <p class="text-muted small">Common maintenance problems report</p>
                                    <a href="#" class="btn btn-sm btn-outline-primary">Generate Report</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cleaning Progress Chart
            const cleaningProgressCtx = document.getElementById('cleaningProgressChart').getContext('2d');
            const cleaningProgressChart = new Chart(cleaningProgressCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'In Progress', 'Pending'],
                    datasets: [{
                        data: [@completedTodayCount, @(roomsToCleanCount - priorityRoomsCount), @priorityRoomsCount],
                        backgroundColor: ['#198754', '#0d6efd', '#ffc107'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    </script>
}