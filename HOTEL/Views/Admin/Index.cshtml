@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    // Set default values if ViewBag properties are null
    var occupancyRate = ViewBag.OccupancyRate ?? 0.0;
    var totalRooms = ViewBag.TotalRooms ?? 0;
    var occupiedRooms = ViewBag.OccupiedRooms ?? 0;
    var vacantRooms = ViewBag.VacantRooms ?? 0;
    var maintenanceRooms = ViewBag.MaintenanceRooms ?? 0;
    var activeStaff = ViewBag.ActiveStaff ?? 0;
    var todayRevenue = ViewBag.TodayRevenue ?? 0.0;
    var yesterdayRevenue = ViewBag.YesterdayRevenue ?? 0.0;
}

<div class="container py-4">
    <h1 class="mb-4">Admin Dashboard</h1>

    <div class="row">
        <div class="col-12 mb-4">
            <h2>Welcome to The Matrix Hotel Admin Dashboard</h2>
            <p class="text-muted">Manage your hotel operations from this central dashboard.</p>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-success">Occupancy Rate</h5>
                    <p class="text-muted">Current hotel occupancy</p>
                    <h1 class="display-4 text-success">@occupancyRate.ToString("0.0")%</h1>
                    <p class="text-muted"><i class="fas fa-info-circle text-muted"></i> @occupiedRooms of @totalRooms rooms occupied</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-primary">Active Staff</h5>
                    <p class="text-muted">Staff currently on duty</p>
                    <h1 class="display-4 text-primary">@activeStaff</h1>
                    <p class="text-muted">From all departments</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-warning">Today's Revenue</h5>
                    <p class="text-muted">Total earnings today</p>
                    <h1 class="display-4 text-warning">$@todayRevenue.ToString("N0")</h1>
                    @{
                        var difference = todayRevenue - yesterdayRevenue;
                        var differenceText = difference >= 0 ? 
                            $"+${difference:N0} from yesterday" : 
                            $"-${Math.Abs(difference):N0} from yesterday";
                        var differenceIcon = difference >= 0 ? 
                            "fas fa-arrow-up text-success" : 
                            "fas fa-arrow-down text-danger";
                    }
                    <p class="text-muted"><i class="@differenceIcon"></i> @differenceText</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Bookings</h5>
                    <a href="@Url.Action("Index", "Booking")" class="btn btn-sm btn-outline-success">View All</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Guest Name</th>
                                    <th>Room</th>
                                    <th>Check-in</th>
                                    <th>Check-out</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" class="text-center py-4">
                                        <i class="fas fa-calendar-times text-muted mb-3" style="font-size: 2rem;"></i>
                                        <p class="text-muted mb-0">No recent bookings found</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Room Status</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="text-center">
                            <h5 class="text-success">@occupiedRooms</h5>
                            <small class="text-muted">Occupied</small>
                        </div>
                        <div class="text-center">
                            <h5 class="text-primary">@vacantRooms</h5>
                            <small class="text-muted">Vacant</small>
                        </div>
                        <div class="text-center">
                            <h5 class="text-warning">@maintenanceRooms</h5>
                            <small class="text-muted">Maintenance</small>
                        </div>
                        <div class="text-center">
                            <h5 class="text-danger">@(totalRooms - occupiedRooms - vacantRooms - maintenanceRooms)</h5>
                            <small class="text-muted">Other</small>
                        </div>
                    </div>
                    <div class="progress" style="height: 25px;">
                        @{ 
                            var occupiedPercent = totalRooms > 0 ? (double)occupiedRooms / totalRooms * 100 : 0;
                            var vacantPercent = totalRooms > 0 ? (double)vacantRooms / totalRooms * 100 : 0;
                            var maintenancePercent = totalRooms > 0 ? (double)maintenanceRooms / totalRooms * 100 : 0;
                            var otherPercent = totalRooms > 0 ? (double)(totalRooms - occupiedRooms - vacantRooms - maintenanceRooms) / totalRooms * 100 : 0;
                        }
                        <div class="progress-bar bg-success" style="width: @occupiedPercent%;" role="progressbar" aria-valuenow="@occupiedPercent" aria-valuemin="0" aria-valuemax="100">@occupiedPercent.ToString("0")%</div>
                        <div class="progress-bar bg-primary" style="width: @vacantPercent%;" role="progressbar" aria-valuenow="@vacantPercent" aria-valuemin="0" aria-valuemax="100">@vacantPercent.ToString("0")%</div>
                        <div class="progress-bar bg-warning" style="width: @maintenancePercent%;" role="progressbar" aria-valuenow="@maintenancePercent" aria-valuemin="0" aria-valuemax="100">@maintenancePercent.ToString("0")%</div>
                        <div class="progress-bar bg-danger" style="width: @otherPercent%;" role="progressbar" aria-valuenow="@otherPercent" aria-valuemin="0" aria-valuemax="100">@otherPercent.ToString("0")%</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Activities</h5>
                    <a href="#" class="btn btn-sm btn-outline-success">View All</a>
                </div>
                <div class="card-body">
                    <!-- In a real implementation, these would come from a database -->
                    <div class="activity-item d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="bg-light rounded-circle p-2">
                                <i class="fas fa-user-check text-success"></i>
                            </div>
                        </div>
                        <div>
                            <p class="mb-0"><strong>New check-in:</strong> Room 301 checked in by FrontDesk</p>
                            <small class="text-muted">@DateTime.Now.AddMinutes(-10).ToString("hh:mm tt")</small>
                        </div>
                    </div>
                    <div class="activity-item d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="bg-light rounded-circle p-2">
                                <i class="fas fa-broom text-primary"></i>
                            </div>
                        </div>
                        <div>
                            <p class="mb-0"><strong>Room cleaning:</strong> Room 205 marked as cleaned</p>
                            <small class="text-muted">@DateTime.Now.AddMinutes(-25).ToString("hh:mm tt")</small>
                        </div>
                    </div>
                    <div class="activity-item d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="bg-light rounded-circle p-2">
                                <i class="fas fa-credit-card text-warning"></i>
                            </div>
                        </div>
                        <div>
                            <p class="mb-0"><strong>Payment received:</strong> $@todayRevenue.ToString("0.00") for today</p>
                            <small class="text-muted">@DateTime.Now.AddMinutes(-35).ToString("hh:mm tt")</small>
                        </div>
                    </div>
                    <div class="activity-item d-flex align-items-start">
                        <div class="me-3">
                            <div class="bg-light rounded-circle p-2">
                                <i class="fas fa-tools text-danger"></i>
                            </div>
                        </div>
                        <div>
                            <p class="mb-0"><strong>Maintenance request:</strong> Room 118 - AC not working</p>
                            <small class="text-muted">@DateTime.Now.AddMinutes(-45).ToString("hh:mm tt")</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
